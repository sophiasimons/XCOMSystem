<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>XCOM Desktop Popup</title>
    <style>
      body { font-family: system-ui, sans-serif; padding: 12px }
      #log { height: 220px; overflow: auto; border: 1px solid #ccc; padding: 8px }
    </style>
  </head>
  <body>
    <h2>XCOM Desktop Popup</h2>
    <label>WS Bridge URL: <input id="wsUrl" value="ws://127.0.0.1:8765"></label>
    <button id="connect">Connect</button>
    <div>
      <input id="msg" placeholder="type message" style="width:70%">
      <button id="send">Send</button>
    </div>
    <h3>Log</h3>
    <div id="log"></div>

    <script>
    const log = (s)=>{
      const el = document.getElementById('log');
      el.innerText += s + "\n";
      el.scrollTop = el.scrollHeight;
    }

    let ws = null;

    document.getElementById('connect').addEventListener('click', ()=>{
      const url = document.getElementById('wsUrl').value;
      if(ws){ ws.close(); ws = null; }
      ws = new WebSocket(url);
      ws.onopen = ()=> log('WS open');
      ws.onclose = ()=> log('WS closed');
      ws.onerror = (e)=> log('WS error: '+e);
      ws.onmessage = (m)=> log('RX: ' + m.data);
    });

    document.getElementById('send').addEventListener('click', ()=>{
      const v = document.getElementById('msg').value;
      if(!ws || ws.readyState !== WebSocket.OPEN){ log('WS not open'); return }
      const obj = {type:'raw', data:v};
      ws.send(JSON.stringify(obj));
      log('TX: '+JSON.stringify(obj));
    });
    </script>
  </body>
</html>
